<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Booking Management - LynxLite</title>
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />
    <!-- Fonts and icons -->
    <script src="assets/js/plugin/webfont/webfont.min.js"></script>
    <script>
      WebFont.load({
        google: { families: ["Public Sans:300,400,500,600,700"] },
        custom: {
          families: [
            "Font Awesome 5 Solid",
            "Font Awesome 5 Regular", 
            "Font Awesome 5 Brands",
            "simple-line-icons",
          ],
          urls: ["assets/css/fonts.min.css"],
        },
        active: function () {
          sessionStorage.fonts = true;
        },
      });
    </script>
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/plugins.min.css" />
    <link rel="stylesheet" href="assets/css/lynxlite.min.css" />
    <link rel="stylesheet" href="assets/css/demo.css" />
    <link rel="stylesheet" href="assets/css/unified-custom.css" />
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="wrapper">
      <!-- Sidebar -->
      <div class="sidebar" data-background-color="dark">
        <div class="sidebar-logo">
          <div class="logo-header" data-background-color="dark">
            <a href="index2.html" class="logo">
              <img src="assets/img/lynxlite/logo_light.svg" alt="LynxLite - Acacus" class="navbar-brand" height="45" />
            </a>
            <div class="nav-toggle">
              <button class="btn btn-toggle toggle-sidebar"><i class="gg-menu-right"></i></button>
              <button class="btn btn-toggle sidenav-toggler"><i class="gg-menu-left"></i></button>
            </div>
            <button class="topbar-toggler more"><i class="gg-more-vertical-alt"></i></button>
          </div>
        </div>
        <div class="sidebar-wrapper scrollbar scrollbar-inner">
          <div class="sidebar-content">
            <ul class="nav nav-secondary">
              <li class="nav-item">
                <a href="index2.html"><i class="fas fa-home"></i><p>Dashboard (Overview)</p></a>
              </li>
              <li class="nav-item">
                <a href="fleet-management.html"><i class="fas fa-car"></i><p>Fleet Management</p></a>
              </li>
              <li class="nav-item active">
                <a href="booking-management.html"><i class="fas fa-calendar-alt"></i><p>Booking Management</p></a>
              </li>
              <li class="nav-item">
                <a href="customer-management.html"><i class="fas fa-users"></i><p>Customer Management</p></a>
              </li>
              <li class="nav-item">
                <a href="billing-payments.html"><i class="fas fa-credit-card"></i><p>Billing & Payments</p></a>
              </li>
              <li class="nav-item">
                <a href="maintenance-compliance.html"><i class="fas fa-wrench"></i><p>Maintenance & Compliance</p></a>
              </li>
              <li class="nav-item">
                <a href="telematics-tracking.html"><i class="fas fa-map-marked-alt"></i><p>Telematics & Tracking</p></a>
              </li>
              <li class="nav-item">
                <a href="reports-analytics.html"><i class="fas fa-chart-line"></i><p>Reports & Analytics</p></a>
              </li>
              <li class="nav-item">
                <a href="branch-staff-management.html"><i class="fas fa-building"></i><p>Branch / Staff Management</p></a>
              </li>
              <li class="nav-item">
                <a href="#"><i class="fas fa-cogs"></i><p>System Settings</p></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- End Sidebar -->
      
      <div class="main-panel">
        <div class="main-header">
          <div class="main-header-logo">
            <div class="logo-header" data-background-color="dark">
              <a href="index2.html" class="logo">
                <img src="assets/img/lynxlite/logo_light.svg" alt="LynxLite - Acacus" class="navbar-brand" height="20" />
              </a>
              <div class="nav-toggle">
                <button class="btn btn-toggle toggle-sidebar"><i class="gg-menu-right"></i></button>
                <button class="btn btn-toggle sidenav-toggler"><i class="gg-menu-left"></i></button>
              </div>
              <button class="topbar-toggler more"><i class="gg-more-vertical-alt"></i></button>
            </div>
          </div>
          <!-- Navbar Header -->
          <nav class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom">
            <div class="container-fluid">
              <nav class="navbar navbar-header-left navbar-expand-lg navbar-form nav-search p-0 d-none d-lg-flex">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <button type="submit" class="btn btn-search pe-1">
                      <i class="fa fa-search search-icon"></i>
                    </button>
                  </div>
                  <input type="text" placeholder="Search bookings..." class="form-control" id="globalSearch" />
                </div>
              </nav>
              <ul class="navbar-nav topbar-nav ms-md-auto align-items-center">
                <li class="nav-item d-flex align-items-center">
                  <div class="form-check form-switch mb-0 ms-2">
                    <input class="form-check-input" type="checkbox" id="darkModeSwitch" />
                    <label class="form-check-label" for="darkModeSwitch" style="color:inherit;">Dark Mode</label>
                  </div>
                </li>
                <li class="nav-item topbar-icon dropdown hidden-caret d-flex d-lg-none">
                  <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false" aria-haspopup="true">
                    <i class="fa fa-search"></i>
                  </a>
                  <ul class="dropdown-menu dropdown-search animated fadeIn">
                    <form class="navbar-left navbar-form nav-search">
                      <div class="input-group">
                        <input type="text" placeholder="Search bookings..." class="form-control" />
                      </div>
                    </form>
                  </ul>
                </li>
                <li class="nav-item topbar-icon dropdown hidden-caret">
                  <a class="nav-link dropdown-toggle" href="#" id="messageDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-envelope"></i>
                  </a>
                  <ul class="dropdown-menu messages-notif-box animated fadeIn" aria-labelledby="messageDropdown">
                    <li>
                      <div class="dropdown-title d-flex justify-content-between align-items-center">Messages <a href="#" class="small">Mark all as read</a></div>
                    </li>
                    <li>
                      <div class="message-notif-scroll scrollbar-outer">
                        <div class="notif-center">
                          <a href="#"><div class="notif-img"><img src="assets/img/jm_denis.jpg" alt="Img Profile" /></div><div class="notif-content"><span class="subject">John Smith</span><span class="block">Booking extension request</span><span class="time">5 minutes ago</span></div></a>
                        </div>
                      </div>
                    </li>
                    <li><a class="see-all" href="javascript:void(0);">See all messages<i class="fa fa-angle-right"></i></a></li>
                  </ul>
                </li>
                <li class="nav-item topbar-icon dropdown hidden-caret">
                  <a class="nav-link dropdown-toggle" href="#" id="notifDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-bell"></i><span class="notification">3</span>
                  </a>
                  <ul class="dropdown-menu notif-box animated fadeIn" aria-labelledby="notifDropdown">
                    <li><div class="dropdown-title">You have 3 new notifications</div></li>
                    <li>
                      <div class="notif-scroll scrollbar-outer">
                        <div class="notif-center">
                          <a href="#" class="notif-item"><div class="notif-icon notif-danger"><i class="fas fa-exclamation-triangle"></i></div><div class="notif-content"><span class="block">Vehicle overdue: ABC123</span><span class="time">2 minutes ago</span></div></a>
                          <a href="#" class="notif-item"><div class="notif-icon notif-warning"><i class="fas fa-clock"></i></div><div class="notif-content"><span class="block">Booking expires in 1 hour</span><span class="time">15 minutes ago</span></div></a>
                          <a href="#" class="notif-item"><div class="notif-icon notif-success"><i class="fas fa-check"></i></div><div class="notif-content"><span class="block">New booking confirmed</span><span class="time">1 hour ago</span></div></a>
                        </div>
                      </div>
                    </li>
                    <li><a class="see-all" href="javascript:void(0);">See all notifications<i class="fa fa-angle-right"></i></a></li>
                  </ul>
                </li>
                <li class="nav-item topbar-icon dropdown hidden-caret">
                  <a class="nav-link" data-bs-toggle="dropdown" href="#" aria-expanded="false"><i class="fas fa-layer-group"></i></a>
                  <div class="dropdown-menu quick-actions animated fadeIn">
                    <div class="quick-actions-header"><span class="title mb-1">Quick Actions</span><span class="subtitle op-7">Shortcuts</span></div>
                    <div class="quick-actions-scroll scrollbar-outer">
                      <div class="quick-actions-items">
                        <div class="row m-0">
                          <a class="col-6 col-md-4 p-0" href="fleet-management.html"><div class="quick-actions-item"><div class="avatar-item bg-primary rounded-circle"><i class="fas fa-car"></i></div><span class="text">Fleet</span></div></a>
                          <a class="col-6 col-md-4 p-0" href="telematics-tracking.html"><div class="quick-actions-item"><div class="avatar-item bg-warning rounded-circle"><i class="fas fa-map"></i></div><span class="text">Tracking</span></div></a>
                          <a class="col-6 col-md-4 p-0" href="reports-analytics.html"><div class="quick-actions-item"><div class="avatar-item bg-info rounded-circle"><i class="fas fa-file-excel"></i></div><span class="text">Reports</span></div></a>
                          <a class="col-6 col-md-4 p-0" href="customer-management.html"><div class="quick-actions-item"><div class="avatar-item bg-success rounded-circle"><i class="fas fa-users"></i></div><span class="text">Customers</span></div></a>
                          <a class="col-6 col-md-4 p-0" href="billing-payments.html"><div class="quick-actions-item"><div class="avatar-item bg-danger rounded-circle"><i class="fas fa-credit-card"></i></div><span class="text">Payments</span></div></a>
                          <a class="col-6 col-md-4 p-0" href="maintenance-compliance.html"><div class="quick-actions-item"><div class="avatar-item bg-secondary rounded-circle"><i class="fas fa-wrench"></i></div><span class="text">Maintenance</span></div></a>
                        </div>
                      </div>
                    </div>
                  </div>
                </li>
                <li class="nav-item topbar-user dropdown hidden-caret">
                  <a class="dropdown-toggle profile-pic" data-bs-toggle="dropdown" href="#" aria-expanded="false">
                    <div class="avatar-sm"><i class="fas fa-user-circle fa-2x"></i></div>
                    <span class="profile-username"><span class="op-7">Hi,</span> <span class="fw-bold">Admin</span></span>
                  </a>
                  <ul class="dropdown-menu dropdown-user animated fadeIn">
                    <div class="dropdown-user-scroll scrollbar-outer">
                      <li>
                        <div class="user-box">
                          <div class="avatar-lg"><i class="fas fa-user-circle fa-3x"></i></div>
                          <div class="u-text">
                            <h4>Admin</h4>
                            <p class="text-muted">hello@example.com</p>
                            <a href="profile.html" class="btn btn-xs btn-secondary btn-sm">View Profile</a>
                          </div>
                        </div>
                      </li>
                      <li>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">My Profile</a>
                        <a class="dropdown-item" href="#">My Balance</a>
                        <a class="dropdown-item" href="#">Inbox</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Account Setting</a>
                        <a class="dropdown-item" href="#">Logout</a>
                      </li>
                    </div>
                  </ul>
                </li>
              </ul>
            </div>
          </nav>
          
        </div>
        
        <!-- Booking Management Content -->
        <div class="container">
          <div class="page-inner">
            <!-- Quick Stats Cards -->
            <div class="row">
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div class="icon-big text-center icon-primary bubble-shadow-small">
                          <i class="fas fa-calendar-check"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3">
                        <div class="numbers">
                          <p class="card-category">Today's Bookings</p>
                          <h4 class="card-title">23</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div class="icon-big text-center icon-info bubble-shadow-small">
                          <i class="fas fa-hourglass-half"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3">
                        <div class="numbers">
                          <p class="card-category">Pending Pickup</p>
                          <h4 class="card-title">8</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div class="icon-big text-center icon-success bubble-shadow-small">
                          <i class="fas fa-car"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3">
                        <div class="numbers">
                          <p class="card-category">Active Rentals</p>
                          <h4 class="card-title">47</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-md-3">
                <div class="card card-stats card-round">
                  <div class="card-body">
                    <div class="row align-items-center">
                      <div class="col-icon">
                        <div class="icon-big text-center icon-danger bubble-shadow-small">
                          <i class="fas fa-exclamation-triangle"></i>
                        </div>
                      </div>
                      <div class="col col-stats ms-3">
                        <div class="numbers">
                          <p class="card-category">Overdue Returns</p>
                          <h4 class="card-title">3</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Overdue Returns Section (Priority) -->
            <div class="row">
              <div class="col-md-12">
                <div class="card border-danger">
                  <div class="card-header bg-danger text-white">
                    <div class="d-flex align-items-center">
                      <h4 class="card-title mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Overdue Returns - Immediate Action Required</h4>
                      <div class="ms-auto">
                        <button class="btn btn-light btn-sm" onclick="sendAllOverdueReminders()">
                          <i class="fas fa-envelope"></i> Send All Reminders
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>Customer</th>
                            <th>Vehicle</th>
                            <th>Due Date</th>
                            <th>Days Overdue</th>
                            <th>Contact</th>
                            <th>Late Fees</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody id="overdueTableBody">
                          <tr class="table-danger">
                            <td>
                              <div class="d-flex align-items-center">
                                <div class="avatar avatar-sm me-3">
                                  <i class="fas fa-user-circle fa-2x"></i>
                                </div>
                                <div>
                                  <div class="fw-bold">Lisa Wong</div>
                                  <small class="text-muted">lisa.wong@email.com</small>
                                </div>
                              </div>
                            </td>
                            <td>
                              <div>
                                <div class="fw-bold">Nissan Altima</div>
                                <small class="text-muted">Plate: GHI012</small>
                              </div>
                            </td>
                            <td>
                              <div class="text-danger fw-bold">Dec 8, 2024</div>
                              <small class="text-muted">5:00 PM</small>
                            </td>
                            <td>
                              <span class="badge bg-danger fs-6">3 Days</span>
                            </td>
                            <td>
                              <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" title="Call">
                                  <i class="fas fa-phone"></i>
                                </button>
                                <button class="btn btn-outline-info" title="SMS">
                                  <i class="fas fa-sms"></i>
                                </button>
                                <button class="btn btn-outline-warning" title="Email">
                                  <i class="fas fa-envelope"></i>
                                </button>
                              </div>
                            </td>
                            <td>
                              <div class="text-warning fw-bold">$75.00</div>
                              <small class="text-muted">$25/day</small>
                            </td>
                            <td>
                              <div class="btn-group btn-group-sm">
                                <button class="btn btn-success" onclick="extendRental('BK001')" title="Extend">
                                  <i class="fas fa-plus-circle"></i>
                                </button>
                                <button class="btn btn-warning" onclick="applyLateFee('BK001')" title="Apply Fee">
                                  <i class="fas fa-dollar-sign"></i>
                                </button>
                                <button class="btn btn-danger" onclick="escalateOverdue('BK001')" title="Escalate">
                                  <i class="fas fa-exclamation"></i>
                                </button>
                              </div>
                            </td>
                          </tr>
                          <tr class="table-warning">
                            <td>
                              <div class="d-flex align-items-center">
                                <div class="avatar avatar-sm me-3">
                                  <img src="assets/img/profile2.jpg" alt="Customer" class="avatar-img rounded-circle">
                                </div>
                                <div>
                                  <div class="fw-bold">James Miller</div>
                                  <small class="text-muted">james.m@email.com</small>
                                </div>
                              </div>
                            </td>
                            <td>
                              <div>
                                <div class="fw-bold">BMW X3</div>
                                <small class="text-muted">Plate: JKL345</small>
                              </div>
                            </td>
                            <td>
                              <div class="text-warning fw-bold">Dec 10, 2024</div>
                              <small class="text-muted">2:00 PM</small>
                            </td>
                            <td>
                              <span class="badge bg-warning fs-6">1 Day</span>
                            </td>
                            <td>
                              <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" title="Call">
                                  <i class="fas fa-phone"></i>
                                </button>
                                <button class="btn btn-outline-info" title="SMS">
                                  <i class="fas fa-sms"></i>
                                </button>
                                <button class="btn btn-outline-warning" title="Email">
                                  <i class="fas fa-envelope"></i>
                                </button>
                              </div>
                            </td>
                            <td>
                              <div class="text-warning fw-bold">$25.00</div>
                              <small class="text-muted">$25/day</small>
                            </td>
                            <td>
                              <div class="btn-group btn-group-sm">
                                <button class="btn btn-success" onclick="extendRental('BK002')" title="Extend">
                                  <i class="fas fa-plus-circle"></i>
                                </button>
                                <button class="btn btn-warning" onclick="applyLateFee('BK002')" title="Apply Fee">
                                  <i class="fas fa-dollar-sign"></i>
                                </button>
                                <button class="btn btn-danger" onclick="escalateOverdue('BK002')" title="Escalate">
                                  <i class="fas fa-exclamation"></i>
                                </button>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- View Toggle and Filters -->
            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header">
                    <div class="d-flex align-items-center justify-content-between">
                      <h4 class="card-title">View Reservations</h4>
                      <div class="d-flex gap-2">
                        <div class="btn-group" role="group">
                          <input type="radio" class="btn-check" name="viewMode" id="listView" autocomplete="off" checked>
                          <label class="btn btn-outline-primary" for="listView">
                            <i class="fas fa-list"></i> List View
                          </label>
                          <input type="radio" class="btn-check" name="viewMode" id="calendarView" autocomplete="off">
                          <label class="btn btn-outline-primary" for="calendarView">
                            <i class="fas fa-calendar"></i> Calendar View
                          </label>
                        </div>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#newBookingModal">
                          <i class="fas fa-plus"></i> New Booking
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <!-- Filters -->
                    <div class="row mb-4">
                      <div class="col-md-3">
                        <label class="form-label">Customer</label>
                        <select class="form-select" id="filterCustomer">
                          <option value="">All Customers</option>
                          <option value="john-smith">John Smith</option>
                          <option value="sarah-johnson">Sarah Johnson</option>
                          <option value="mike-davis">Mike Davis</option>
                          <option value="lisa-wong">Lisa Wong</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Branch</label>
                        <select class="form-select" id="filterBranch">
                          <option value="">All Branches</option>
                          <option value="manhattan">Manhattan</option>
                          <option value="brooklyn">Brooklyn</option>
                          <option value="queens">Queens</option>
                          <option value="bronx">Bronx</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Vehicle Type</label>
                        <select class="form-select" id="filterVehicleType">
                          <option value="">All Types</option>
                          <option value="economy">Economy</option>
                          <option value="compact">Compact</option>
                          <option value="mid-size">Mid-size</option>
                          <option value="suv">SUV</option>
                          <option value="luxury">Luxury</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <label class="form-label">Date Range</label>
                        <input type="date" class="form-control" id="filterDateFrom" placeholder="From">
                      </div>
                    </div>

                    <!-- List View -->
                    <div id="listViewContainer">
                      <div class="table-responsive">
                        <table class="table table-hover">
                          <thead>
                            <tr>
                              <th>Booking ID</th>
                              <th>Customer</th>
                              <th>Vehicle</th>
                              <th>Pickup</th>
                              <th>Return</th>
                              <th>Status</th>
                              <th>Total</th>
                              <th>Actions</th>
                            </tr>
                          </thead>
                          <tbody id="bookingsTableBody">
                            <!-- Populated by JavaScript -->
                          </tbody>
                        </table>
                      </div>
                    </div>

                    <!-- Calendar View -->
                    <div id="calendarViewContainer" style="display: none;">
                      <div id="bookingCalendar"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modify Booking Modal -->
    <div class="modal fade" id="modifyBookingModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modify Booking</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="modifyBookingForm">
              <div class="row">
                <div class="col-md-6">
                  <h6 class="mb-3">Current Booking Details</h6>
                  <div id="currentBookingDetails">
                    <!-- Populated by JavaScript -->
                  </div>
                </div>
                <div class="col-md-6">
                  <h6 class="mb-3">Modify Booking</h6>
                  <div class="mb-3">
                    <label class="form-label">New Pickup Date/Time</label>
                    <input type="datetime-local" class="form-control" id="newPickupDate" onchange="recalculatePrice()">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">New Return Date/Time</label>
                    <input type="datetime-local" class="form-control" id="newReturnDate" onchange="recalculatePrice()">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Change Vehicle</label>
                    <select class="form-select" id="newVehicle" onchange="recalculatePrice()">
                      <option value="">Keep current vehicle</option>
                      <!-- Populated by JavaScript -->
                    </select>
                  </div>
                  <div class="alert alert-info" id="priceRecalculation" style="display: none;">
                    <strong>Price Update:</strong>
                    <div id="priceBreakdown"></div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-warning" onclick="cancelBooking()">
              <i class="fas fa-times"></i> Cancel Booking
            </button>
            <button type="button" class="btn btn-success" onclick="extendBooking()">
              <i class="fas fa-plus-circle"></i> Extend Booking
            </button>
            <button type="button" class="btn btn-primary" onclick="saveModifications()">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- New Booking Modal -->
    <div class="modal fade" id="newBookingModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">New Booking</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="newBookingForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Customer *</label>
                    <select class="form-select" id="newCustomer" required>
                      <option value="">Select Customer</option>
                      <option value="john-smith">John Smith</option>
                      <option value="sarah-johnson">Sarah Johnson</option>
                      <option value="mike-davis">Mike Davis</option>
                      <option value="lisa-wong">Lisa Wong</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Vehicle Type *</label>
                    <select class="form-select" id="newVehicleType" required>
                      <option value="">Select Type</option>
                      <option value="economy">Economy</option>
                      <option value="compact">Compact</option>
                      <option value="mid-size">Mid-size</option>
                      <option value="suv">SUV</option>
                      <option value="luxury">Luxury</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Branch *</label>
                    <select class="form-select" id="newBranch" required>
                      <option value="">Select Branch</option>
                      <option value="manhattan">Manhattan</option>
                      <option value="brooklyn">Brooklyn</option>
                      <option value="queens">Queens</option>
                      <option value="bronx">Bronx</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Pickup Date/Time *</label>
                    <input type="datetime-local" class="form-control" id="newPickup" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Return Date/Time *</label>
                    <input type="datetime-local" class="form-control" id="newReturn" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Additional Options</label>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="gpsOption">
                      <label class="form-check-label" for="gpsOption">GPS Navigation (+$5/day)</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="insuranceOption">
                      <label class="form-check-label" for="insuranceOption">Additional Insurance (+$15/day)</label>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createBooking()">
              <i class="fas fa-plus"></i> Create Booking
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- JS Files -->
    <script src="assets/js/core/jquery-3.7.1.min.js"></script>
    <script src="assets/js/core/popper.min.js"></script>
    <script src="assets/js/core/bootstrap.min.js"></script>
    <script src="assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
    <script src="assets/js/lynxlite.min.js"></script>
    
    <!-- Feedback System -->
    <script src="assets/js/feedback-system.js"></script>
    
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
    
    <script>
      // Dark mode toggle logic
      function setDarkMode(enabled) {
        if (enabled) {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
        }
      }
      // Dark mode initialization function
      function initializeDarkMode() {
        const darkModeSwitch = document.getElementById('darkModeSwitch');
        const darkPref = localStorage.getItem('darkMode') === 'true';
        setDarkMode(darkPref);
        if (darkModeSwitch) darkModeSwitch.checked = darkPref;
        if (darkModeSwitch) {
          darkModeSwitch.addEventListener('change', function() {
            setDarkMode(this.checked);
            localStorage.setItem('darkMode', this.checked);
          });
        }
      }

      // Sample booking data
      const bookingData = [
        {
          id: 'BK001',
          customer: { name: 'John Smith', email: 'john.smith@email.com', phone: '+1-555-0123' },
          vehicle: { make: 'Toyota', model: 'Camry', plate: 'ABC123', type: 'mid-size' },
          pickup: { date: '2024-12-11', time: '09:00', branch: 'Manhattan' },
          return: { date: '2024-12-14', time: '17:00', branch: 'Manhattan' },
          status: 'confirmed',
          total: 285.00,
          dailyRate: 65.00
        },
        {
          id: 'BK002', 
          customer: { name: 'Sarah Johnson', email: 'sarah.j@email.com', phone: '+1-555-0124' },
          vehicle: { make: 'Honda', model: 'CR-V', plate: 'XYZ789', type: 'suv' },
          pickup: { date: '2024-12-12', time: '10:30', branch: 'Brooklyn' },
          return: { date: '2024-12-15', time: '14:00', branch: 'Brooklyn' },
          status: 'active',
          total: 225.00,
          dailyRate: 75.00
        },
        {
          id: 'BK003',
          customer: { name: 'Mike Davis', email: 'mike.d@email.com', phone: '+1-555-0125' },
          vehicle: { make: 'Ford', model: 'Focus', plate: 'DEF456', type: 'compact' },
          pickup: { date: '2024-12-13', time: '14:15', branch: 'Queens' },
          return: { date: '2024-12-16', time: '12:00', branch: 'Queens' },
          status: 'pending',
          total: 150.00,
          dailyRate: 50.00
        }
      ];

      let currentBookingId = null;
      let calendar;

      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize dark mode first
        initializeDarkMode();

        populateBookingsTable();
        initializeCalendar();
        setupViewToggle();
        setupFilters();
      });

      function populateBookingsTable() {
        populateBookingsTableWithData(bookingData);
      }

      function getBookingStatusBadge(status) {
        const statusMap = {
          'confirmed': { class: 'primary', text: 'Confirmed' },
          'active': { class: 'success', text: 'Active' },
          'pending': { class: 'warning', text: 'Pending' },
          'completed': { class: 'info', text: 'Completed' },
          'cancelled': { class: 'danger', text: 'Cancelled' },
          'escalated': { class: 'dark', text: 'Escalated' }
        };
        const statusInfo = statusMap[status] || { class: 'secondary', text: status };
        return `<span class="badge bg-${statusInfo.class}">${statusInfo.text}</span>`;
      }

      function initializeCalendar() {
        const calendarEl = document.getElementById('bookingCalendar');
        
        calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
          },
          events: bookingData.map(booking => ({
            id: booking.id,
            title: `${booking.customer.name} - ${booking.vehicle.make} ${booking.vehicle.model}`,
            start: `${booking.pickup.date}T${booking.pickup.time}`,
            end: `${booking.return.date}T${booking.return.time}`,
            color: getCalendarEventColor(booking.status),
            extendedProps: booking
          })),
          eventClick: function(info) {
            openModifyModal(info.event.id);
          },
          editable: true,
          eventDrop: function(info) {
            // Handle drag and drop
            updateBookingDates(info.event.id, info.event.start, info.event.end);
          }
        });
      }

      function getCalendarEventColor(status) {
        const colorMap = {
          'confirmed': '#007bff',
          'active': '#28a745', 
          'pending': '#ffc107',
          'completed': '#17a2b8',
          'cancelled': '#dc3545'
        };
        return colorMap[status] || '#6c757d';
      }

      function setupViewToggle() {
        document.getElementById('listView').addEventListener('change', function() {
          if (this.checked) {
            document.getElementById('listViewContainer').style.display = 'block';
            document.getElementById('calendarViewContainer').style.display = 'none';
          }
        });

        document.getElementById('calendarView').addEventListener('change', function() {
          if (this.checked) {
            document.getElementById('listViewContainer').style.display = 'none';
            document.getElementById('calendarViewContainer').style.display = 'block';
            if (calendar) {
              setTimeout(() => calendar.render(), 100);
            }
          }
        });
      }

      function setupFilters() {
        // Populate filter options first
        populateFilterOptions();

        // Add event listeners for all filters
        ['filterCustomer', 'filterBranch', 'filterVehicleType', 'filterDateFrom', 'filterDateTo'].forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.addEventListener('change', applyFilters);
          }
        });

        const globalSearch = document.getElementById('globalSearch');
        if (globalSearch) {
          globalSearch.addEventListener('input', applyFilters);
        }
      }

      function populateFilterOptions() {
        const customers = [...new Set(bookingData.map(b => b.customer.name))];
        const branches = [...new Set(bookingData.map(b => b.pickup.branch))];
        const vehicleTypes = [...new Set(bookingData.map(b => b.vehicle.type))];

        // Populate customer filter
        const filterCustomer = document.getElementById('filterCustomer');
        if (filterCustomer) {
          filterCustomer.innerHTML = '<option value="">All Customers</option>';
          customers.forEach(customer => {
            filterCustomer.innerHTML += `<option value="${customer}">${customer}</option>`;
          });
        }

        // Populate branch filter
        const filterBranch = document.getElementById('filterBranch');
        if (filterBranch) {
          filterBranch.innerHTML = '<option value="">All Branches</option>';
          branches.forEach(branch => {
            filterBranch.innerHTML += `<option value="${branch}">${branch}</option>`;
          });
        }

        // Populate vehicle type filter
        const filterVehicleType = document.getElementById('filterVehicleType');
        if (filterVehicleType) {
          filterVehicleType.innerHTML = '<option value="">All Vehicle Types</option>';
          vehicleTypes.forEach(type => {
            filterVehicleType.innerHTML += `<option value="${type}">${type.charAt(0).toUpperCase() + type.slice(1)}</option>`;
          });
        }
      }

      function applyFilters() {
        const customerFilter = document.getElementById('filterCustomer')?.value || '';
        const branchFilter = document.getElementById('filterBranch')?.value || '';
        const vehicleTypeFilter = document.getElementById('filterVehicleType')?.value || '';
        const dateFromFilter = document.getElementById('filterDateFrom')?.value || '';
        const dateToFilter = document.getElementById('filterDateTo')?.value || '';
        const globalSearch = document.getElementById('globalSearch')?.value.toLowerCase() || '';

        let filteredData = bookingData.filter(booking => {
          // Filter by customer
          const matchesCustomer = !customerFilter || booking.customer.name === customerFilter;

          // Filter by branch
          const matchesBranch = !branchFilter || booking.pickup.branch === branchFilter;

          // Filter by vehicle type
          const matchesVehicleType = !vehicleTypeFilter || booking.vehicle.type === vehicleTypeFilter;

          // Filter by date range
          let matchesDateRange = true;
          if (dateFromFilter || dateToFilter) {
            const pickupDate = new Date(booking.pickup.date);
            if (dateFromFilter) {
              matchesDateRange = matchesDateRange && pickupDate >= new Date(dateFromFilter);
            }
            if (dateToFilter) {
              matchesDateRange = matchesDateRange && pickupDate <= new Date(dateToFilter);
            }
          }

          // Global search across multiple fields
          let matchesGlobalSearch = true;
          if (globalSearch) {
            const searchableText = [
              booking.id,
              booking.customer.name,
              booking.customer.email,
              booking.vehicle.make,
              booking.vehicle.model,
              booking.vehicle.plate,
              booking.pickup.branch,
              booking.status
            ].join(' ').toLowerCase();

            matchesGlobalSearch = searchableText.includes(globalSearch);
          }

          return matchesCustomer && matchesBranch && matchesVehicleType && matchesDateRange && matchesGlobalSearch;
        });

        populateBookingsTableWithData(filteredData);

        // Update results count
        const resultsCount = document.getElementById('resultsCount');
        if (resultsCount) {
          resultsCount.textContent = `Showing ${filteredData.length} of ${bookingData.length} bookings`;
        }
      }

      function populateBookingsTableWithData(data) {
        const tbody = document.getElementById('bookingsTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';

        data.forEach(booking => {
          const statusBadge = getBookingStatusBadge(booking.status);
          const pickupDateTime = new Date(`${booking.pickup.date}T${booking.pickup.time}`);
          const returnDateTime = new Date(`${booking.return.date}T${booking.return.time}`);
          const row = `
            <tr>
              <td><strong>${booking.id}</strong></td>
              <td>
                <div>
                  <div class="fw-bold">${booking.customer.name}</div>
                  <small class="text-muted">${booking.customer.email}</small>
                </div>
              </td>
              <td>
                <div>
                  <div class="fw-bold">${booking.vehicle.make} ${booking.vehicle.model}</div>
                  <small class="text-muted">${booking.vehicle.plate} â€¢ ${booking.vehicle.type}</small>
                </div>
              </td>
              <td>
                <div class="text-nowrap">
                  <div><i class="fas fa-calendar"></i> ${pickupDateTime.toLocaleDateString()}</div>
                  <small class="text-muted"><i class="fas fa-clock"></i> ${pickupDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                </div>
              </td>
              <td>
                <div class="text-nowrap">
                  <div><i class="fas fa-calendar"></i> ${returnDateTime.toLocaleDateString()}</div>
                  <small class="text-muted"><i class="fas fa-clock"></i> ${returnDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                </div>
              </td>
              <td>${statusBadge}</td>
              <td><strong>$${booking.total.toFixed(2)}</strong></td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn btn-outline-primary" onclick="viewBookingDetails('${booking.id}')" title="View Details">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-outline-success" onclick="checkInOut('${booking.id}')" title="Check In/Out">
                    <i class="fas fa-${booking.status === 'confirmed' ? 'sign-out-alt' : 'sign-in-alt'}"></i>
                  </button>
                  <button class="btn btn-outline-warning" onclick="openModifyModal('${booking.id}')" title="Modify">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
          tbody.innerHTML += row;
        });

        // If no results, show empty state
        if (data.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="8" class="text-center py-4">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <p class="text-muted">No bookings found matching your criteria</p>
              </td>
            </tr>
          `;
        }
      }

      function openModifyModal(bookingId) {
        currentBookingId = bookingId;
        const booking = bookingData.find(b => b.id === bookingId);
        
        if (booking) {
          // Populate current booking details
          document.getElementById('currentBookingDetails').innerHTML = `
            <div class="mb-2"><strong>Customer:</strong> ${booking.customer.name}</div>
            <div class="mb-2"><strong>Vehicle:</strong> ${booking.vehicle.make} ${booking.vehicle.model} (${booking.vehicle.plate})</div>
            <div class="mb-2"><strong>Pickup:</strong> ${booking.pickup.date} ${booking.pickup.time} - ${booking.pickup.branch}</div>
            <div class="mb-2"><strong>Return:</strong> ${booking.return.date} ${booking.return.time} - ${booking.return.branch}</div>
            <div class="mb-2"><strong>Status:</strong> ${getBookingStatusBadge(booking.status)}</div>
            <div class="mb-2"><strong>Current Total:</strong> $${booking.total.toFixed(2)}</div>
          `;

          // Set form values
          document.getElementById('newPickupDate').value = `${booking.pickup.date}T${booking.pickup.time}`;
          document.getElementById('newReturnDate').value = `${booking.return.date}T${booking.return.time}`;
          
          new bootstrap.Modal(document.getElementById('modifyBookingModal')).show();
        }
      }

      function recalculatePrice() {
        const newPickup = document.getElementById('newPickupDate').value;
        const newReturn = document.getElementById('newReturnDate').value;
        
        if (newPickup && newReturn) {
          const pickupDate = new Date(newPickup);
          const returnDate = new Date(newReturn);
          const days = Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24));
          
          const booking = bookingData.find(b => b.id === currentBookingId);
          const newTotal = days * booking.dailyRate;
          const difference = newTotal - booking.total;
          
          document.getElementById('priceRecalculation').style.display = 'block';
          document.getElementById('priceBreakdown').innerHTML = `
            <div>Original: $${booking.total.toFixed(2)}</div>
            <div>New Total: $${newTotal.toFixed(2)} (${days} days Ã— $${booking.dailyRate})</div>
            <div class="${difference >= 0 ? 'text-success' : 'text-danger'}">
              Difference: ${difference >= 0 ? '+' : ''}$${difference.toFixed(2)}
            </div>
          `;
        }
      }

      function extendBooking() {
        const newReturnDate = document.getElementById('newReturnDate').value;
        if (!newReturnDate) {
          alert('Please select a new return date to extend the booking.');
          return;
        }
        
        saveModifications();
      }

      function cancelBooking() {
        if (confirm('Are you sure you want to cancel this booking? This action cannot be undone.')) {
          const booking = bookingData.find(b => b.id === currentBookingId);
          if (booking) {
            booking.status = 'cancelled';
            populateBookingsTable();
            bootstrap.Modal.getInstance(document.getElementById('modifyBookingModal')).hide();
            alert('Booking cancelled successfully.');
          }
        }
      }

      function saveModifications() {
        const newPickup = document.getElementById('newPickupDate').value;
        const newReturn = document.getElementById('newReturnDate').value;
        
        if (newPickup && newReturn) {
          const booking = bookingData.find(b => b.id === currentBookingId);
          if (booking) {
            // Update booking data
            const [pickupDate, pickupTime] = newPickup.split('T');
            const [returnDate, returnTime] = newReturn.split('T');
            
            booking.pickup.date = pickupDate;
            booking.pickup.time = pickupTime;
            booking.return.date = returnDate;
            booking.return.time = returnTime;
            
            // Recalculate total
            const days = Math.ceil((new Date(newReturn) - new Date(newPickup)) / (1000 * 60 * 60 * 24));
            booking.total = days * booking.dailyRate;
            
            populateBookingsTable();
            if (calendar) {
              calendar.refetchEvents();
            }
            
            bootstrap.Modal.getInstance(document.getElementById('modifyBookingModal')).hide();
            alert('Booking updated successfully!');
          }
        }
      }

      function viewBookingDetails(bookingId) {
        const booking = bookingData.find(b => b.id === bookingId);
        if (!booking) return;

        const pickupDateTime = new Date(`${booking.pickup.date}T${booking.pickup.time}`);
        const returnDateTime = new Date(`${booking.return.date}T${booking.return.time}`);
        const duration = Math.ceil((returnDateTime - pickupDateTime) / (1000 * 60 * 60 * 24));

        // Create detailed view modal
        const modalHtml = `
          <div class="modal fade" id="bookingDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Booking Details - ${booking.id}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-md-6">
                      <h6 class="fw-bold mb-3">Customer Information</h6>
                      <p><strong>Name:</strong> ${booking.customer.name}</p>
                      <p><strong>Email:</strong> ${booking.customer.email}</p>
                      <p><strong>Phone:</strong> ${booking.customer.phone}</p>

                      <h6 class="fw-bold mb-3 mt-4">Vehicle Information</h6>
                      <p><strong>Vehicle:</strong> ${booking.vehicle.make} ${booking.vehicle.model}</p>
                      <p><strong>License Plate:</strong> ${booking.vehicle.plate}</p>
                      <p><strong>Type:</strong> ${booking.vehicle.type}</p>
                    </div>
                    <div class="col-md-6">
                      <h6 class="fw-bold mb-3">Rental Details</h6>
                      <p><strong>Pickup:</strong> ${pickupDateTime.toLocaleDateString()} at ${pickupDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                      <p><strong>Return:</strong> ${returnDateTime.toLocaleDateString()} at ${returnDateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                      <p><strong>Duration:</strong> ${duration} day${duration > 1 ? 's' : ''}</p>
                      <p><strong>Branch:</strong> ${booking.pickup.branch}</p>
                      <p><strong>Status:</strong> ${getBookingStatusBadge(booking.status)}</p>

                      <h6 class="fw-bold mb-3 mt-4">Pricing</h6>
                      <p><strong>Daily Rate:</strong> $${booking.dailyRate.toFixed(2)}</p>
                      <p><strong>Total Amount:</strong> <span class="fs-5 fw-bold text-success">$${booking.total.toFixed(2)}</span></p>
                      ${booking.extras ? `
                        <small class="text-muted">
                          ${booking.extras.gps ? 'â€¢ GPS Navigation included<br>' : ''}
                          ${booking.extras.insurance ? 'â€¢ Additional Insurance included<br>' : ''}
                        </small>
                      ` : ''}
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-warning" onclick="openModifyModal('${booking.id}'); bootstrap.Modal.getInstance(document.getElementById('bookingDetailsModal')).hide();">Modify Booking</button>
                  ${booking.status === 'confirmed' ? `<button type="button" class="btn btn-success" onclick="checkInOut('${booking.id}'); bootstrap.Modal.getInstance(document.getElementById('bookingDetailsModal')).hide();">Check Out Vehicle</button>` : ''}
                  ${booking.status === 'active' ? `<button type="button" class="btn btn-primary" onclick="checkInOut('${booking.id}'); bootstrap.Modal.getInstance(document.getElementById('bookingDetailsModal')).hide();">Return Vehicle</button>` : ''}
                </div>
              </div>
            </div>
          </div>
        `;

        // Remove existing modal if present
        const existingModal = document.getElementById('bookingDetailsModal');
        if (existingModal) existingModal.remove();

        // Add new modal to body
        document.body.insertAdjacentHTML('beforeend', modalHtml);

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('bookingDetailsModal'));
        modal.show();
      }

      function checkInOut(bookingId) {
        const booking = bookingData.find(b => b.id === bookingId);
        if (booking) {
          if (booking.status === 'confirmed') {
            booking.status = 'active';
            alert('Vehicle checked out successfully!');
          } else if (booking.status === 'active') {
            booking.status = 'completed';
            alert('Vehicle returned successfully!');
          }
          populateBookingsTable();
        }
      }

      function createBooking() {
        // Get form values
        const customer = document.getElementById('newCustomer').value;
        const vehicleType = document.getElementById('newVehicleType').value;
        const branch = document.getElementById('newBranch').value;
        const pickup = document.getElementById('newPickup').value;
        const returnDate = document.getElementById('newReturn').value;
        const gpsOption = document.getElementById('gpsOption').checked;
        const insuranceOption = document.getElementById('insuranceOption').checked;

        // Validate required fields
        if (!customer || !vehicleType || !branch || !pickup || !returnDate) {
          alert('Please fill in all required fields.');
          return;
        }

        // Validate date range
        const pickupDateTime = new Date(pickup);
        const returnDateTime = new Date(returnDate);
        if (returnDateTime <= pickupDateTime) {
          alert('Return date must be after pickup date.');
          return;
        }

        // Calculate duration and pricing
        const days = Math.ceil((returnDateTime - pickupDateTime) / (1000 * 60 * 60 * 24));
        const baseRates = {
          'economy': 45,
          'compact': 55,
          'mid-size': 65,
          'suv': 75,
          'luxury': 95
        };

        let dailyRate = baseRates[vehicleType] || 65;
        let total = days * dailyRate;

        // Add optional extras
        if (gpsOption) total += days * 5;
        if (insuranceOption) total += days * 15;

        // Customer data mapping
        const customerData = {
          'john-smith': { name: 'John Smith', email: 'john.smith@email.com', phone: '+1-555-0123' },
          'sarah-johnson': { name: 'Sarah Johnson', email: 'sarah.j@email.com', phone: '+1-555-0124' },
          'mike-davis': { name: 'Mike Davis', email: 'mike.davis@email.com', phone: '+1-555-0125' },
          'lisa-wong': { name: 'Lisa Wong', email: 'lisa.wong@email.com', phone: '+1-555-0126' }
        };

        // Generate new booking ID
        const newId = 'BK' + String(Math.max(...bookingData.map(b => parseInt(b.id.substring(2)))) + 1).padStart(3, '0');

        // Create new booking object
        const newBooking = {
          id: newId,
          customer: customerData[customer] || { name: 'Unknown Customer', email: '', phone: '' },
          vehicle: {
            make: 'Available',
            model: vehicleType.charAt(0).toUpperCase() + vehicleType.slice(1),
            plate: 'TBD',
            type: vehicleType
          },
          pickup: {
            date: pickup.split('T')[0],
            time: pickup.split('T')[1],
            branch: branch.charAt(0).toUpperCase() + branch.slice(1)
          },
          return: {
            date: returnDate.split('T')[0],
            time: returnDate.split('T')[1],
            branch: branch.charAt(0).toUpperCase() + branch.slice(1)
          },
          status: 'confirmed',
          total: total,
          dailyRate: dailyRate,
          extras: {
            gps: gpsOption,
            insurance: insuranceOption
          }
        };

        // Add to bookingData
        bookingData.push(newBooking);

        // Refresh the table and calendar
        populateBookingsTable();
        populateFilterOptions(); // Refresh filter options
        if (calendar) {
          calendar.refetchEvents();
        }

        // Close modal and show success message
        bootstrap.Modal.getInstance(document.getElementById('newBookingModal')).hide();
        alert(`Booking ${newId} created successfully!\nTotal: $${total.toFixed(2)} for ${days} days`);

        // Reset form
        document.getElementById('newBookingForm').reset();
      }

      // Overdue actions
      function extendRental(bookingId) {
        const days = prompt('Extend this rental by how many days?', '1');
        if (!days || isNaN(days) || parseInt(days) <= 0) {
          return;
        }

        const booking = bookingData.find(b => b.id === bookingId);
        if (!booking) return;

        const extensionDays = parseInt(days);
        const currentReturnDate = new Date(`${booking.return.date}T${booking.return.time}`);
        const newReturnDate = new Date(currentReturnDate.getTime() + (extensionDays * 24 * 60 * 60 * 1000));

        // Calculate additional cost
        const additionalCost = extensionDays * booking.dailyRate;
        if (booking.extras) {
          if (booking.extras.gps) additionalCost += extensionDays * 5;
          if (booking.extras.insurance) additionalCost += extensionDays * 15;
        }

        if (confirm(`Extend rental for ${extensionDays} day(s)?\n\nNew return date: ${newReturnDate.toLocaleDateString()} at ${newReturnDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\nAdditional cost: $${additionalCost.toFixed(2)}\nNew total: $${(booking.total + additionalCost).toFixed(2)}`)) {

          // Update booking
          booking.return.date = newReturnDate.toISOString().split('T')[0];
          booking.return.time = newReturnDate.toISOString().split('T')[1].substring(0, 5);
          booking.total += additionalCost;

          // Refresh displays
          populateBookingsTable();
          if (calendar) {
            calendar.refetchEvents();
          }

          alert(`Rental ${bookingId} extended successfully for ${extensionDays} day(s)!\nAdditional charge: $${additionalCost.toFixed(2)}`);
        }
      }

      function applyLateFee(bookingId) {
        const booking = bookingData.find(b => b.id === bookingId);
        if (!booking) return;

        const lateFeeAmount = 50; // Fixed late fee amount
        const dailyLateFee = 15; // Daily late fee

        // Calculate how many days overdue
        const returnDate = new Date(`${booking.return.date}T${booking.return.time}`);
        const today = new Date();
        const daysOverdue = Math.max(0, Math.ceil((today - returnDate) / (1000 * 60 * 60 * 24)));

        const totalLateFee = lateFeeAmount + (daysOverdue * dailyLateFee);

        if (confirm(`Apply late fee to booking ${bookingId}?\n\nBase late fee: $${lateFeeAmount}\nDaily penalty (${daysOverdue} days): $${(daysOverdue * dailyLateFee)}\nTotal late fee: $${totalLateFee}\n\nThis will be added to the booking total.`)) {

          booking.total += totalLateFee;
          booking.lateFeeApplied = true;
          booking.lateFeeAmount = totalLateFee;

          populateBookingsTable();
          alert(`Late fee of $${totalLateFee} applied to booking ${bookingId}`);
        }
      }

      function escalateOverdue(bookingId) {
        const booking = bookingData.find(b => b.id === bookingId);
        if (!booking) return;

        const returnDate = new Date(`${booking.return.date}T${booking.return.time}`);
        const today = new Date();
        const daysOverdue = Math.ceil((today - returnDate) / (1000 * 60 * 60 * 24));

        if (confirm(`Escalate overdue booking ${bookingId} to management/insurance?\n\nCustomer: ${booking.customer.name}\nVehicle: ${booking.vehicle.make} ${booking.vehicle.model}\nDays overdue: ${daysOverdue}\n\nThis will mark the booking as escalated and notify management.`)) {

          booking.status = 'escalated';
          booking.escalationDate = new Date().toISOString().split('T')[0];
          booking.daysOverdue = daysOverdue;

          populateBookingsTable();
          alert(`Booking ${bookingId} escalated successfully.\nManagement and insurance have been notified.\nCustomer: ${booking.customer.name}\nContact: ${booking.customer.phone}`);
        }
      }

      function sendAllOverdueReminders() {
        const today = new Date();
        const overdueBookings = bookingData.filter(booking => {
          const returnDate = new Date(`${booking.return.date}T${booking.return.time}`);
          return returnDate < today && booking.status === 'active';
        });

        if (overdueBookings.length === 0) {
          alert('No overdue bookings found.');
          return;
        }

        if (confirm(`Send reminder notifications to all ${overdueBookings.length} overdue customers?\n\nOverdue bookings:\n${overdueBookings.map(b => `â€¢ ${b.id} - ${b.customer.name}`).join('\n')}`)) {

          // Mark all as reminded
          overdueBookings.forEach(booking => {
            booking.reminderSent = new Date().toISOString().split('T')[0];
            booking.reminderCount = (booking.reminderCount || 0) + 1;
          });

          alert(`Reminder notifications sent to ${overdueBookings.length} overdue customers:\n${overdueBookings.map(b => `â€¢ ${b.customer.name} (${b.customer.email})`).join('\n')}`);
        }
      }

      function updateBookingDates(bookingId, newStart, newEnd) {
        const booking = bookingData.find(b => b.id === bookingId);
        if (booking) {
          // Update the booking dates after calendar drag/drop
          console.log(`Updated booking ${bookingId} dates`);
        }
      }
    </script>
  </body>
</html>